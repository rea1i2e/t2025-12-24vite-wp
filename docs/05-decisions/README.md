# Architecture Decision Records (ADR)

このディレクトリは **ADR（Architecture Decision Record）** を置く場所です。  
「なぜこの判断をしたか」を将来の自分・メンバー・AIが追えるようにするため、**迷いが再発しやすい技術判断**を記録します。

---

## ADRにする判断の基準

次のようなテーマはADRに記録することを推奨します。

- **ビルド・ツール**: Vite連携、エントリ設計、本番/開発の切り替え
- **アセット**: 画像最適化、フォント読み込み、CSS/JSの読み込み戦略
- **WordPressとの統合**: テーマ構造、フックの使い方、アセットのenqueue
- **ディレクトリ・命名**: `functions-lib` / `components` の役割、関数プレフィックス（`ty_`）
- **コーディング方針**: データとHTMLの分離、マージン規約、入れ子の深さ

「後から見返して理由を説明したい」「同じ迷いが別メンバーやAIで繰り返されそう」という判断が対象です。

---

## ステータス定義

| ステータス | 意味 | 次の状態の例 |
|-----------|------|----------------|
| **Proposed** | 提案中。まだ確定していない | Accepted / Rejected |
| **Accepted** | 採用済み。現行の決定 | Deprecated / Superseded |
| **Deprecated** | 廃止。使わない方針にした | （そのまま終了） |
| **Superseded** | 別のADRに置き換えられた | 本文で「Superseded by NNNN-xxx」を記載 |

- 通常は **Accepted** で運用し、方針が変わったら **Deprecated** または **Superseded** に更新する。
- **Superseded** の場合は、どのADRに置き換えられたかを必ず明記する。

---

## ファイル名と見出しの一致

- **ファイル名**: `NNNN-短いタイトル.md`（例: `0007-image-optimization.md`）
- **Markdownの見出し（# タイトル）**: ファイル名の「NNNN-」を除いた部分、またはそれと同一の意味のタイトルにする。

例: ファイル `0007-image-optimization.md` の先頭見出しは  
`# 0007-image-optimization` または `# image-optimization`（ファイル名と対応が分かるようにする）。

これにより、ファイル名だけ見ても内容が推測でき、検索・参照がしやすくなります。

---

## 置き換え・廃止時の扱い

- **別のADRに置き換えた場合**
  - 古いADRのステータスを **Superseded** に変更する。
  - 本文の「関連ADR」または末尾に **「Superseded by NNNN-新しいタイトル」** を追記する。
  - 新しいADR側には **「Supersedes NNNN-古いタイトル」** を記載する。
- **単純に廃止した場合**（別ADRで置き換えない）
  - ステータスを **Deprecated** にし、廃止理由を「結果」または専用節に短く書く。

---

## ADRのテンプレート

新しいADRを書くときは、次の形をベースにしてください。**見出しタイトルはファイル名と一致させます。**

```markdown
# NNNN-ファイル名と同じタイトル

**ステータス**: Proposed | Accepted | Deprecated | Superseded

## コンテキスト

意思決定が必要になった背景。

## 決定

採用した解決策。

## 結果

決定による影響・注意点。

## 関連ADR

- 関連するADR（Supersedes / Superseded by など）
```

---

## 意思決定時にAIへ渡すプロンプト（テンプレ）

新しい技術判断をする前に、次のプロンプトをコピーしてAIに渡し、ADR案を出してもらうときに使えます。

```
【依頼】
このプロジェクトの ADR（Architecture Decision Records）を 1 本書きたいです。
docs/05-decisions/README.md の「ADRのテンプレート」と「ファイル名と見出しの一致」のルールに従ってください。

【判断の概要】
（ここに、何を決めたいか・何を決めたかを 1〜3 行で書く）

【コンテキスト】
（背景・なぜこの判断が必要か）

【決定内容】
（採用した案・方針）

【結果・影響】
（チームや実装への影響、注意点）

【既存ADRとの関係】
（あれば）Supersedes / Superseded by / 関連する ADR の番号やファイル名

上記を踏まえ、docs/05-decisions/ に追加する ADR のファイル名（NNNN-xxx.md）と、Markdown 本文を提案してください。
```

---

## ADR作成用プロンプト（毎回使用）

次のプロンプトをコピーし、**【入力情報】** を埋めてから AI に渡すと、1 件分の ADR を生成できます。テックリード視点で、このプロジェクト固有の判断が書かれた ADR を作成するために使います。

```
【ADR作成用プロンプト（毎回使用）】

あなたはこのWordPress制作プロジェクトのテックリードです。
以下の情報をもとに、ADR（Architecture Decision Record）を1件作成してください。

【前提】
- 本リポジトリは WordPress（クラシックテーマ）制作テンプレート
- docs/05-decisions/ 配下で ADR を管理している
- 将来「なぜこの判断をしたのか」を他人と自分が理解できることが目的

【入力情報】
- 決定したいテーマ：
- 背景・課題：
- 検討した選択肢（最低2つ）：
- 採用した結論：
- 採用理由：
- トレードオフ・欠点：
- 影響範囲（開発・運用・保守）：

【出力ルール】
- ファイル名は `NNNN-kebab-case.md`
- 見出しタイトルはファイル名と一致させる
- 以下の構成を必ず含める
  - Status
  - Context
  - Decision
  - Consequences
- 冗長な説明や一般論は避け、このプロジェクト固有の判断を書く
```

---

## 既存の意思決定について

過去の重要な意思決定は `docs/06-reference/migration-log.md` にも記録されています。必要に応じて、重要なものをADR形式に起こしてこのディレクトリに追加してください。
